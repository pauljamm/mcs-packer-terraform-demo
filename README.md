# MCS Pakcer / Terraform demo

## Подготовка

1. Регистрируемся в Mail.ru Cloud Solutions
1. Заходим в личный кабинет MCS, переходим в раздел "Настройки проекта"
и на вкладке "API ключи" нажимаем "Скачать openrc версии 3"
1. После скачивания файла нужно загрузить из него переменные командой
```bash
$ source <путь к скачанному файлу>
```
При вызове этой команды скрипт поросит ввести пароль от своей учетной записи в MCS

## Сборка образа с помощью Packer

1. Локально должены быть установлены утилиты packer и ansible
1. Переходим в директорию packer/nginx/ в этом проекте
1. Создаем там файл vars.pkr.hcl со следующим содержимым
```hcl
image_tag = "1.0.0"
```
1. Запускаем сборку образа командой
```bash
packer build -var-file vars.pkr.hcl nginx.pkr.hcl
```

## Создание инфраструктуры с помощью Terraform

1. Локально должна быть установлена утилита Terraform
1. Переходим в директорию terraform/ в этом проекте
1. Создаем там файл vars.tfvars со следующим содержимым
```hcl
image_tag = "1.0.0"
node_count = 3
```
1. Запускаем создание инфраструктуры командой
```bash
terraform apply -var-file vars.tfvars -auto-approve
```
